"use strict";function createScene(){console.log("Create Scene"),HEIGHT=window.innerHeight,WIDTH=window.innerWidth,scene=new THREE.Scene,scene.fog=new THREE.Fog(Colors.backgroundColor,500,2e3),aspectRatio=WIDTH/HEIGHT,fieldOfView=45,nearPlane=1,farPlane=1e4,camera=new THREE.PerspectiveCamera(fieldOfView,aspectRatio,nearPlane,farPlane),camera.position.x=500,camera.position.z=500,camera.position.y=300,camera.lookAt(new THREE.Vector3(0,0,0));var e=new THREE.AxisHelper(100);scene.add(e),renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),renderer.setSize(WIDTH,HEIGHT),renderer.shadowMap.enabled=!0,container=document.getElementById("room"),container.appendChild(renderer.domElement),window.addEventListener("resize",handleWindowResize,!1)}function handleWindowResize(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,renderer.setSize(WIDTH,HEIGHT),camera.aspect=WIDTH/HEIGHT,camera.updateProjectionMatrix()}function render(){shadowLight.position.copy(camera.position),renderer.render(scene,camera)}function createLights(){var e=new THREE.HemisphereLight(Colors.lightColor,0,.9);shadowLight=new THREE.DirectionalLight(Colors.lightColor,.9),shadowLight.position.set(150,350,350),shadowLight.position.copy(camera.position),shadowLight.castShadow=!0,shadowLight.shadow.camera.left=-400,shadowLight.shadow.camera.right=400,shadowLight.shadow.camera.top=400,shadowLight.shadow.camera.bottom=-400,shadowLight.shadow.camera.near=1,shadowLight.shadow.camera.far=1e3,shadowLight.shadow.mapSize.width=2048,shadowLight.shadow.mapSize.height=2048,scene.add(e),scene.add(shadowLight)}function onDocumentMouseDown(e){if(0===objectsInScene.length)return!1;e.preventDefault(),mousePosition.x=e.clientX/window.innerWidth*2-1,mousePosition.y=2*-(e.clientY/window.innerHeight)+1,raycaster.setFromCamera(mousePosition,camera);var t=raycaster.intersectObjects(objectsInScene);t.length>0&&null!=t[0].object.click&&t[0].object.click()}function onDocumentMouseOver(e){if(0===objectsInScene.length)return!1;e.preventDefault(),mousePosition.x=e.clientX/window.innerWidth*2-1,mousePosition.y=2*-(e.clientY/window.innerHeight)+1,raycaster.setFromCamera(mousePosition,camera);var t=raycaster.intersectObjects(objectsInScene);t.length>0?(null!=t[0].object.click&&document.body.classList.add("mouseOnSelectableObject"),null!=t[0].object.hover&&t[0].object.hover()):document.body.classList.remove("mouseOnSelectableObject")}function merge(){for(var e,t,o,i=arguments[0]||{},r=1,n=arguments.length;r<n;r++)if(null!=(e=arguments[r]))for(t in e)o=e[t],i!==o&&void 0!==o&&(i[t]=o);return i}function createScene(){console.log("Create Scene"),HEIGHT=window.innerHeight,WIDTH=window.innerWidth,scene=new THREE.Scene,scene.fog=new THREE.Fog(Colors.backgroundColor,500,2e3),aspectRatio=WIDTH/HEIGHT,fieldOfView=45,nearPlane=1,farPlane=1e4,camera=new THREE.PerspectiveCamera(fieldOfView,aspectRatio,nearPlane,farPlane),camera.position.x=-500,camera.position.z=500,camera.position.y=300,camera.lookAt(new THREE.Vector3(0,0,0)),renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),renderer.setSize(WIDTH,HEIGHT),renderer.shadowMap.enabled=!0,container=document.getElementById("room"),container.appendChild(renderer.domElement),window.addEventListener("resize",handleWindowResize,!1)}function handleWindowResize(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,renderer.setSize(WIDTH,HEIGHT),camera.aspect=WIDTH/HEIGHT,camera.updateProjectionMatrix()}function render(){shadowLight.position.copy(camera.position),renderer.render(scene,camera)}function createLights(){var e=new THREE.HemisphereLight(11184810,0,.9);shadowLight=new THREE.DirectionalLight(16777215,.9),shadowLight.position.set(150,350,350),shadowLight.position.copy(camera.position),shadowLight.castShadow=!0,shadowLight.shadow.camera.left=-400,shadowLight.shadow.camera.right=400,shadowLight.shadow.camera.top=400,shadowLight.shadow.camera.bottom=-400,shadowLight.shadow.camera.near=1,shadowLight.shadow.camera.far=1e3,shadowLight.shadow.mapSize.width=2048,shadowLight.shadow.mapSize.height=2048,scene.add(e),scene.add(shadowLight)}var Avatar=function(e){e=merge({shirtColor:40},e||{}),this.mesh=new THREE.Object3D,this.mesh.castShadow=!0,this.mesh.receiveShadow=!0;var t=new Cube({x:100,y:100,z:100});this.mesh.add(t.mesh);var o=new Arm({type:"right"});o.mesh.rotation.x+=.4,this.mesh.add(o.mesh);var o=new Arm({type:"left"});o.mesh.rotation.x+=.4,this.mesh.add(o.mesh);var i=new Leg({type:"left"});this.mesh.add(i.mesh);var i=new Leg({type:"right"});this.mesh.add(i.mesh);var r=new Head({});this.mesh.add(r.mesh);var n=new Hair({});this.mesh.add(n.mesh),this.mesh.castShadow=!0,this.mesh.position.y+=20},Head=function(e){e=merge({type:"right"},e||{}),this.mesh=new THREE.Object3D;var t=new Cube({color:16176051,x:120,y:120,z:120});t.mesh.position.y+=110,this.mesh.add(t.mesh)},Hair=function(e){e=merge({color:10402751},e||{}),this.mesh=new THREE.Object3D;var t=new Cube({color:e.color,x:130,y:80,z:120});t.mesh.position.y+=135,t.mesh.position.z-=5;var o=new Cube({color:e.color,x:130,y:30,z:80});o.mesh.position.y+=80,o.mesh.position.z-=25;var i=new THREE.Geometry,r=new THREE.BoxGeometry(130,80,120,1,1,1);r.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,-5)),i.merge(r,r.matrix);var n=new THREE.BoxGeometry(130,30,30,1,1,1);n.applyMatrix((new THREE.Matrix4).makeTranslation(0,-55,-50)),i.merge(n,n.matrix);var a=new THREE.MeshPhongMaterial({color:e.color,transparent:!0,opacity:1,shading:THREE.FlatShading}),t=new THREE.Mesh(i,a);t.position.y+=135,this.mesh.add(t)},Arm=function(e){e=merge({type:"right"},e||{}),this.mesh=new THREE.Object3D;var t=new Cube({x:25,y:25,z:25}),o=new Cube({color:16176051,x:25,y:25,z:50}),i=new Cube({color:16176051,x:20,y:20,z:20});o.mesh.position.z=36.5,i.mesh.position.z=65,t.mesh.add(o.mesh),t.mesh.add(i.mesh),"left"==e.type?t.mesh.position.x+=62.5:"right"==e.type&&(t.mesh.position.x-=62.5),t.mesh.position.z+=12.5,t.mesh.position.y+=25,this.mesh.add(t.mesh)},Hair=function(e){e=merge({color:10402751},e||{}),this.mesh=new THREE.Object3D;var t=new Cube({color:e.color,x:130,y:80,z:120});t.mesh.position.y+=135,t.mesh.position.z-=5;var o=new Cube({color:e.color,x:130,y:30,z:80});o.mesh.position.y+=80,o.mesh.position.z-=25;var i=new THREE.Geometry,r=new THREE.BoxGeometry(130,80,120,1,1,1);r.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,-5)),i.merge(r,r.matrix);var n=new THREE.BoxGeometry(130,30,30,1,1,1);n.applyMatrix((new THREE.Matrix4).makeTranslation(0,-55,-50)),i.merge(n,n.matrix);var a=new THREE.MeshPhongMaterial({color:e.color,transparent:!0,opacity:1,shading:THREE.FlatShading}),t=new THREE.Mesh(i,a);t.position.y+=135,this.mesh.add(t)},Leg=function(e){e=merge({type:"right"},e||{}),this.mesh=new THREE.Object3D;var t=(new Cube({x:25,y:25,z:25}),new Cube({color:Colors.backgroundColor,x:25,y:75,z:25}));t.mesh.position.y-=62.5,this.mesh.add(t.mesh);var o=new Cube({color:0,x:28,y:14,z:46});o.mesh.position.y-=100,o.mesh.position.z+=10,this.mesh.add(o.mesh),"left"==e.type?this.mesh.position.x+=25:"right"==e.type&&(this.mesh.position.x-=25)},Cube=function(e){e=merge({color:Colors.primaryColor,opacity:1,x:40,y:40,z:40},e||{}),this.mesh=new THREE.Object3D;var t=new THREE.BoxGeometry(e.x,e.y,e.z,1,1,1),o=new THREE.MeshPhongMaterial({color:e.color,transparent:!0,opacity:e.opacity,shading:THREE.FlatShading}),i=new THREE.Mesh(t,o);i.castShadow=!0,i.receiveShadow=!0,this.geomerty=t,this.material=o,this.mesh.add(i)},scene,camera,fieldOfView,aspectRatio,nearPlane,farPlane,HEIGHT,WIDTH,renderer,container,shadowLight,objectsInScene=[],Church=function(e){e=merge({numberOfPilarRows:4},e||{}),this.mesh=new THREE.Object3D;for(var t=-1;t<=2;t++){var o=new Pilar,i=new Pilar,r=125,n=100;o.mesh.position.z=t*n-1*(n/2),o.mesh.position.x=-r/2,i.mesh.position.z=t*n-1*(n/2),i.mesh.position.x=r/2,this.mesh.add(o.mesh),this.mesh.add(i.mesh)}var a=new Table({width:130,height:15});a.mesh.position.z-=210,this.mesh.add(a.mesh);var s=new Table({width:60});s.mesh.position.z-=110,s.mesh.position.x-=110,s.mesh.rotation.y=THREE.Math.degToRad(90),this.mesh.add(s.mesh);var h=new Tree({});h.mesh.position.z-=100,this.mesh.add(h.mesh),addTable({x:-130,z:-10}),addTable({x:-100,z:-10}),addTable({x:-70,z:-10}),addTable({x:-40,z:-10}),addTable({x:-130,z:10}),addTable({x:-100,z:10}),addTable({x:-70,z:10}),addTable({x:-40,z:10}),addTable({x:-100,z:90}),addTable({x:-70,z:90}),addTable({x:-100,z:110}),addTable({x:-70,z:110}),addTable({x:50,z:80,rotation:THREE.Math.degToRad(90)}),addTable({x:50,z:110,rotation:THREE.Math.degToRad(90)}),addTable({x:70,z:80,rotation:THREE.Math.degToRad(90)}),addTable({x:70,z:110,rotation:THREE.Math.degToRad(90)}),addTable({x:-130,z:200}),addTable({x:-100,z:200}),addTable({x:-70,z:200}),addTable({x:-40,z:200}),addTable({x:-130,z:220}),addTable({x:-100,z:220}),addTable({x:-70,z:220}),addTable({x:-40,z:220}),addTable({x:130,z:200}),addTable({x:100,z:200}),addTable({x:70,z:200}),addTable({x:130,z:220}),addTable({x:100,z:220}),addTable({x:70,z:220})},Floor=function(e){e=merge({width:300,height:600,positionZ:0,positionX:0,color:Colors.backgroundColor,click:null,hover:null},e||{}),this.width=e.width,this.height=e.height,this.mesh=new THREE.Object3D,this.mesh.castShadow=!0,this.mesh.receiveShadow=!0;var t=new THREE.Mesh(new THREE.PlaneBufferGeometry(e.width,e.height),new THREE.MeshPhongMaterial({color:e.color,transparent:!0,opacity:1}));t.material.side=THREE.DoubleSide,t.receiveShadow=!0,this.mesh.add(t);var o=new THREE.EdgesGeometry(new THREE.PlaneBufferGeometry(e.width,e.height)),i=new THREE.LineBasicMaterial({color:Colors.strokeColor,linewidth:Settings.strokeWidth}),r=new THREE.LineSegments(o,i);this.mesh.rotation.x=Math.PI/2,this.mesh.add(r);var o=new THREE.EdgesGeometry(new THREE.PlaneBufferGeometry(e.width+10,e.height+10)),i=new THREE.LineBasicMaterial({color:Colors.strokeColor,linewidth:Settings.strokeWidth}),r=new THREE.LineSegments(o,i);this.mesh.add(r),this.mesh.position.z=e.positionZ,this.mesh.rotation.x=Math.PI/2},Pilar=function(e){e=merge({height:100,positionZ:0,positionX:0,color:Colors.primaryColor,click:null,hover:null},e||{}),this.mesh=new THREE.Object3D;var t=new THREE.CylinderGeometry(5,5,e.height,32),o=10,i=new THREE.CylinderGeometry(7.5,10,o,32);i.applyMatrix((new THREE.Matrix4).makeTranslation(0,-(e.height/2-o/2),0)),t.merge(i);var r=new THREE.MeshPhongMaterial({color:e.color,shading:THREE.FlatShading}),t=new THREE.Mesh(t,r);t.applyMatrix((new THREE.Matrix4).makeTranslation(0,e.height/2,0)),t.castShadow=!0,t.receiveShadow=!0,this.mesh.add(t)},Table=function(e){e=merge({width:30,depth:20,height:10,colorTableTop:Colors.primaryColor,colorLegs:Colors.primaryColor,click:null,hover:null},e||{}),this.args=e,this.mesh=new THREE.Object3D;var t=new THREE.Geometry,o=new THREE.BoxGeometry(e.width,2,e.depth,1,1,1),i=new THREE.Geometry,r=new THREE.BoxGeometry(2,e.height,2,1,1,1);i.merge(r.applyMatrix((new THREE.Matrix4).makeTranslation(-(e.width/2-1),-(e.height/2)-1,-(e.depth/2)+1))),i.merge(r.applyMatrix((new THREE.Matrix4).makeTranslation(e.width-2,0,0))),i.merge(r.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,e.depth-2))),i.merge(r.applyMatrix((new THREE.Matrix4).makeTranslation(-(e.width-2),0,0))),t.merge(o);var n=new THREE.MeshPhongMaterial({color:e.colorTableTop,shading:THREE.FlatShading}),a=new THREE.MeshPhongMaterial({color:e.colorLegs,shading:THREE.FlatShading}),s=new THREE.Mesh(t,n),h=new THREE.Mesh(i,a);s.add(h),s.castShadow=!0,s.receiveShadow=!0,h.castShadow=!0,h.receiveShadow=!0,s.position.y+=e.height+1,this.mesh.add(s)},addTable=function(e){e=merge({x:0,z:0,rotation:0,click:null,hover:null},e||{});var t=new Table(e);t.mesh.position.z+=e.z,t.mesh.position.x+=e.x,t.mesh.rotation.y=e.rotation,scene.add(t.mesh)},Tree=function(e){e=merge({size:15,height:70,positionX:0,positionZ:0},e||{}),this.mesh=new THREE.Object3D,this.mesh.castShadow=!0,this.mesh.receiveShadow=!0;var t=new THREE.Geometry,o=new THREE.MeshPhongMaterial({color:Colors.primaryColor,shading:THREE.FlatShading}),i=new THREE.CylinderGeometry(e.size,e.size/3,e.size,0,1,!1);t.merge(i.applyMatrix((new THREE.Matrix4).makeTranslation(0,e.size/2,0)));var r=new THREE.CylinderGeometry(2,2,e.height,0,1,!1);t.merge(r.applyMatrix((new THREE.Matrix4).makeTranslation(0,e.height/2,0)));var n=new THREE.SphereGeometry(1.5*e.size,7,7);t.merge(n.applyMatrix((new THREE.Matrix4).makeTranslation(0,e.height+e.size/2,0)));var a=new THREE.Mesh(t,o);this.mesh.add(a)},createWiredObject=function(e){if(e=merge({object:null,color:Colors.strokeColor,click:null,hover:null},e||{}),null==e.object)return!1;this.mesh=new THREE.Object3D;var t=new THREE.Mesh(e.object,e.material);t.castShadow=!0,t.receiveShadow=!0;var o=addStrokeToObject({object:e.object}),i=.98;return t.scale.set(1*i,1*i,1*i),t.click=e.click,t.hover=e.hover,t.add(o),this.mesh.add(t),objectsInScene.push(t),this.mesh},addStrokeToObject=function(e){if(e=merge({object:null,color:Colors.strokeColor,positionZ:0,positionX:0},e||{}),null==e.object)return!1;var t=new THREE.EdgesGeometry(e.object),o=new THREE.LineBasicMaterial({color:e.color,linewidth:Settings.strokeWidth}),i=new THREE.LineSegments(t,o);return i},Settings={strokeWidth:1,fillObjects:!0,init:{intractions:!0}},Colors={primaryColor:146574,secondaryColor:3549,backgroundColor:2133989,strokeColor:16777215},favIcon="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABrUlEQVR42mNkwAOepOgxMTD9mwhk5gDxQSB2l5l15SeyGkYGAuBJMtAQ5n+rgcwgIF4ENCCeJAOghvADXbIHqNoEyK0BGtKK14DXU9lAThZiYPw/XTTr92uId3SVgKoPA8WkgNxIoCErsBrwdhoL57//TGeATC0gfgVUMRlo+2zRjD8vn6RrmzH8ZT4E5IOU+gAN2YNhwMOJ/Ey8bJ+VgGYnAQ3K/f+fkQco/AYYDjP+feHs/fNQyub/N44NQJe0ysy5VI83DF5M5pRkY/mVyfCfIRtomNB/pv9v//9infbnucgZ5l/MW8T7HvxDMWB9hT3nXwbmrH//mO4Bubc4Wb/f9W09+uNmjwQPP/vHNHaWXwX/Gf7LsjD9k+FLZ3iKEQYbKmy1/jKwXIXx//1nfPvvP/MVJsZ/RzlYfpwX4nj/T5zrNbtK8evlWGNhcYU3Px/DR+f/DExGQK4pEKsCseJ/oDKgF0AGMvxjZLIP79xzCMWA3Jyc/yB68pQpGGEyuyJEhJXhtwYLELMx/NL9wcDRcfqLwjOYegwDYGxcAFkNbQxgIALgNIBUQBUDAFi2whGNUZ3eAAAAAElFTkSuQmCC",docHead=document.getElementsByTagName("head")[0],newLink=document.createElement("link");newLink.rel="shortcut icon",newLink.type="image/x-icon",newLink.href="data:image/png;base64,"+favIcon,docHead.appendChild(newLink),Settings.init.intractions&&(document.addEventListener("mousedown",onDocumentMouseDown,!1),document.addEventListener("mousemove",onDocumentMouseOver,!1));var mousePosition=new THREE.Vector2,INTERSECTED,raycaster=new THREE.Raycaster;THREE.ShaderLib.mirror={uniforms:{mirrorColor:{value:new THREE.Color(8355711)},mirrorSampler:{value:null},textureMatrix:{value:new THREE.Matrix4}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 mirrorCoord;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","mirrorCoord = textureMatrix * worldPosition;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 mirrorColor;","uniform sampler2D mirrorSampler;","varying vec4 mirrorCoord;","float blendOverlay(float base, float blend) {","return( base < 0.5 ? ( 2.0 * base * blend ) : (1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","void main() {","vec4 color = texture2DProj(mirrorSampler, mirrorCoord);","color = vec4(blendOverlay(mirrorColor.r, color.r), blendOverlay(mirrorColor.g, color.g), blendOverlay(mirrorColor.b, color.b), 1.0);","gl_FragColor = color;","}"].join("\n")},THREE.Mirror=function(e,t,o){THREE.Object3D.call(this),this.name="mirror_"+this.id,o=o||{},this.matrixNeedsUpdate=!0;var i=void 0!==o.textureWidth?o.textureWidth:512,r=void 0!==o.textureHeight?o.textureHeight:512;this.clipBias=void 0!==o.clipBias?o.clipBias:0;var n=void 0!==o.color?new THREE.Color(o.color):new THREE.Color(8355711);this.renderer=e,this.mirrorPlane=new THREE.Plane,this.normal=new THREE.Vector3(0,0,1),this.mirrorWorldPosition=new THREE.Vector3,this.cameraWorldPosition=new THREE.Vector3,this.rotationMatrix=new THREE.Matrix4,this.lookAtPosition=new THREE.Vector3(0,0,-1),this.clipPlane=new THREE.Vector4;var a=void 0!==o.debugMode&&o.debugMode;if(a){var s=new THREE.ArrowHelper(new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,0),10,16777088),h=new THREE.Geometry;h.vertices.push(new THREE.Vector3(-10,-10,0)),h.vertices.push(new THREE.Vector3(10,-10,0)),h.vertices.push(new THREE.Vector3(10,10,0)),h.vertices.push(new THREE.Vector3(-10,10,0)),h.vertices.push(h.vertices[0]);var c=new THREE.Line(h,new THREE.LineBasicMaterial({color:16777088}));this.add(s),this.add(c)}t instanceof THREE.PerspectiveCamera?this.camera=t:(this.camera=new THREE.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new THREE.Matrix4,this.mirrorCamera=this.camera.clone(),this.mirrorCamera.matrixAutoUpdate=!0;var l={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1};this.renderTarget=new THREE.WebGLRenderTarget(i,r,l),this.renderTarget2=new THREE.WebGLRenderTarget(i,r,l);var d=THREE.ShaderLib.mirror,m=THREE.UniformsUtils.clone(d.uniforms);this.material=new THREE.ShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:m}),this.material.uniforms.mirrorSampler.value=this.renderTarget.texture,this.material.uniforms.mirrorColor.value=n,this.material.uniforms.textureMatrix.value=this.textureMatrix,THREE.Math.isPowerOfTwo(i)&&THREE.Math.isPowerOfTwo(r)||(this.renderTarget.texture.generateMipmaps=!1,this.renderTarget2.texture.generateMipmaps=!1),this.updateTextureMatrix(),this.render()},THREE.Mirror.prototype=Object.create(THREE.Object3D.prototype),THREE.Mirror.prototype.constructor=THREE.Mirror,THREE.Mirror.prototype.renderWithMirror=function(e){this.updateTextureMatrix(),this.matrixNeedsUpdate=!1;var t=e.camera;e.camera=this.mirrorCamera,e.renderTemp(),e.material.uniforms.mirrorSampler.value=e.renderTarget2.texture,this.render(),this.matrixNeedsUpdate=!0,e.material.uniforms.mirrorSampler.value=e.renderTarget.texture,e.camera=t,e.updateTextureMatrix()},THREE.Mirror.prototype.updateTextureMatrix=function(){this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix);var e=this.mirrorWorldPosition.clone().sub(this.cameraWorldPosition);e.reflect(this.normal).negate(),e.add(this.mirrorWorldPosition),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var t=this.mirrorWorldPosition.clone().sub(this.lookAtPosition);t.reflect(this.normal).negate(),t.add(this.mirrorWorldPosition),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix),this.up.reflect(this.normal).negate(),this.mirrorCamera.position.copy(e),this.mirrorCamera.up=this.up,this.mirrorCamera.lookAt(t),this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mirrorWorldPosition),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var o=new THREE.Vector4,i=this.mirrorCamera.projectionMatrix;o.x=(Math.sign(this.clipPlane.x)+i.elements[8])/i.elements[0],o.y=(Math.sign(this.clipPlane.y)+i.elements[9])/i.elements[5],o.z=-1,o.w=(1+i.elements[10])/i.elements[14];var r=new THREE.Vector4;r=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(o)),i.elements[2]=r.x,i.elements[6]=r.y,i.elements[10]=r.z+1-this.clipBias,i.elements[14]=r.w},THREE.Mirror.prototype.render=function(){this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0;for(var e=this;null!==e.parent;)e=e.parent;if(void 0!==e&&e instanceof THREE.Scene){var t=this.material.visible;this.material.visible=!1,this.renderer.render(e,this.mirrorCamera,this.renderTarget,!0),this.material.visible=t}},THREE.Mirror.prototype.renderTemp=function(){this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0;for(var e=this;null!==e.parent;)e=e.parent;void 0!==e&&e instanceof THREE.Scene&&this.renderer.render(e,this.mirrorCamera,this.renderTarget2,!0)},THREE.OrbitControls=function(e,t){function o(){return 2*Math.PI/60/60*z.autoRotateSpeed}function i(){return Math.pow(.95,z.zoomSpeed)}function r(e){V.theta-=e}function n(e){V.phi-=e}function a(e){z.object instanceof THREE.PerspectiveCamera?B/=e:z.object instanceof THREE.OrthographicCamera?(z.object.zoom=Math.max(z.minZoom,Math.min(z.maxZoom,z.object.zoom*e)),z.object.updateProjectionMatrix(),U=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),z.enableZoom=!1)}function s(e){z.object instanceof THREE.PerspectiveCamera?B*=e:z.object instanceof THREE.OrthographicCamera?(z.object.zoom=Math.max(z.minZoom,Math.min(z.maxZoom,z.object.zoom/e)),z.object.updateProjectionMatrix(),U=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),z.enableZoom=!1)}function h(e){Z.set(e.clientX,e.clientY)}function c(e){J.set(e.clientX,e.clientY)}function l(e){K.set(e.clientX,e.clientY)}function d(e){Y.set(e.clientX,e.clientY),X.subVectors(Y,Z);var t=z.domElement===document?z.domElement.body:z.domElement;r(2*Math.PI*X.x/t.clientWidth*z.rotateSpeed),n(2*Math.PI*X.y/t.clientHeight*z.rotateSpeed),Z.copy(Y),z.update()}function m(e){q.set(e.clientX,e.clientY),$.subVectors(q,J),$.y>0?a(i()):$.y<0&&s(i()),J.copy(q),z.update()}function E(e){Q.set(e.clientX,e.clientY),_.subVectors(Q,K),oe(_.x,_.y),K.copy(Q),z.update()}function p(){}function u(e){e.deltaY<0?s(i()):e.deltaY>0&&a(i()),z.update()}function w(e){switch(e.keyCode){case z.keys.UP:oe(0,z.keyPanSpeed),z.update();break;case z.keys.BOTTOM:oe(0,-z.keyPanSpeed),z.update();break;case z.keys.LEFT:oe(z.keyPanSpeed,0),z.update();break;case z.keys.RIGHT:oe(-z.keyPanSpeed,0),z.update()}}function T(e){Z.set(e.touches[0].pageX,e.touches[0].pageY)}function g(e){var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+o*o);J.set(0,i)}function b(e){K.set(e.touches[0].pageX,e.touches[0].pageY)}function H(e){Y.set(e.touches[0].pageX,e.touches[0].pageY),X.subVectors(Y,Z);var t=z.domElement===document?z.domElement.body:z.domElement;r(2*Math.PI*X.x/t.clientWidth*z.rotateSpeed),n(2*Math.PI*X.y/t.clientHeight*z.rotateSpeed),Z.copy(Y),z.update()}function R(e){var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+o*o);q.set(0,r),$.subVectors(q,J),$.y>0?s(i()):$.y<0&&a(i()),J.copy(q),z.update()}function v(e){Q.set(e.touches[0].pageX,e.touches[0].pageY),_.subVectors(Q,K),oe(_.x,_.y),K.copy(Q),z.update()}function f(){}function y(e){if(z.enabled!==!1){if(e.preventDefault(),e.button===z.mouseButtons.ORBIT){if(z.enableRotate===!1)return;h(e),I=W.ROTATE}else if(e.button===z.mouseButtons.ZOOM){if(z.enableZoom===!1)return;c(e),I=W.DOLLY}else if(e.button===z.mouseButtons.PAN){if(z.enablePan===!1)return;l(e),I=W.PAN}I!==W.NONE&&(document.addEventListener("mousemove",x,!1),document.addEventListener("mouseup",M,!1),z.dispatchEvent(D))}}function x(e){if(z.enabled!==!1)if(e.preventDefault(),I===W.ROTATE){if(z.enableRotate===!1)return;d(e)}else if(I===W.DOLLY){if(z.enableZoom===!1)return;m(e)}else if(I===W.PAN){if(z.enablePan===!1)return;E(e)}}function M(e){z.enabled!==!1&&(p(e),document.removeEventListener("mousemove",x,!1),document.removeEventListener("mouseup",M,!1),z.dispatchEvent(A),I=W.NONE)}function C(e){z.enabled===!1||z.enableZoom===!1||I!==W.NONE&&I!==W.ROTATE||(e.preventDefault(),e.stopPropagation(),u(e),z.dispatchEvent(D),z.dispatchEvent(A))}function P(e){z.enabled!==!1&&z.enableKeys!==!1&&z.enablePan!==!1&&w(e)}function S(e){if(z.enabled!==!1){switch(e.touches.length){case 1:if(z.enableRotate===!1)return;T(e),I=W.TOUCH_ROTATE;break;case 2:if(z.enableZoom===!1)return;g(e),I=W.TOUCH_DOLLY;break;case 3:if(z.enablePan===!1)return;b(e),I=W.TOUCH_PAN;break;default:I=W.NONE}I!==W.NONE&&z.dispatchEvent(D)}}function O(e){if(z.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(z.enableRotate===!1)return;if(I!==W.TOUCH_ROTATE)return;H(e);break;case 2:if(z.enableZoom===!1)return;if(I!==W.TOUCH_DOLLY)return;R(e);break;case 3:if(z.enablePan===!1)return;if(I!==W.TOUCH_PAN)return;v(e);break;default:I=W.NONE}}function j(e){z.enabled!==!1&&(f(e),z.dispatchEvent(A),I=W.NONE)}function L(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return N.phi},this.getAzimuthalAngle=function(){return N.theta},this.reset=function(){z.target.copy(z.target0),z.object.position.copy(z.position0),z.object.zoom=z.zoom0,z.object.updateProjectionMatrix(),z.dispatchEvent(k),z.update(),I=W.NONE},this.update=function(){var t=new THREE.Vector3,i=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),n=i.clone().inverse(),a=new THREE.Vector3,s=new THREE.Quaternion;return function(){var e=z.object.position;return t.copy(e).sub(z.target),t.applyQuaternion(i),N.setFromVector3(t),z.autoRotate&&I===W.NONE&&r(o()),N.theta+=V.theta,N.phi+=V.phi,N.theta=Math.max(z.minAzimuthAngle,Math.min(z.maxAzimuthAngle,N.theta)),N.phi=Math.max(z.minPolarAngle,Math.min(z.maxPolarAngle,N.phi)),N.makeSafe(),N.radius*=B,N.radius=Math.max(z.minDistance,Math.min(z.maxDistance,N.radius)),z.target.add(F),t.setFromSpherical(N),t.applyQuaternion(n),e.copy(z.target).add(t),z.object.lookAt(z.target),z.enableDamping===!0?(V.theta*=1-z.dampingFactor,V.phi*=1-z.dampingFactor):V.set(0,0,0),B=1,F.set(0,0,0),!!(U||a.distanceToSquared(z.object.position)>G||8*(1-s.dot(z.object.quaternion))>G)&&(z.dispatchEvent(k),a.copy(z.object.position),s.copy(z.object.quaternion),U=!1,!0)}}(),this.dispose=function(){z.domElement.removeEventListener("contextmenu",L,!1),z.domElement.removeEventListener("mousedown",y,!1),z.domElement.removeEventListener("wheel",C,!1),z.domElement.removeEventListener("touchstart",S,!1),z.domElement.removeEventListener("touchend",j,!1),z.domElement.removeEventListener("touchmove",O,!1),document.removeEventListener("mousemove",x,!1),document.removeEventListener("mouseup",M,!1),window.removeEventListener("keydown",P,!1)};var z=this,k={type:"change"},D={type:"start"},A={type:"end"},W={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},I=W.NONE,G=1e-6,N=new THREE.Spherical,V=new THREE.Spherical,B=1,F=new THREE.Vector3,U=!1,Z=new THREE.Vector2,Y=new THREE.Vector2,X=new THREE.Vector2,K=new THREE.Vector2,Q=new THREE.Vector2,_=new THREE.Vector2,J=new THREE.Vector2,q=new THREE.Vector2,$=new THREE.Vector2,ee=function(){var e=new THREE.Vector3;return function(t,o){e.setFromMatrixColumn(o,0),e.multiplyScalar(-t),F.add(e)}}(),te=function(){var e=new THREE.Vector3;return function(t,o){e.setFromMatrixColumn(o,1),e.multiplyScalar(t),F.add(e)}}(),oe=function(){var e=new THREE.Vector3;return function(t,o){var i=z.domElement===document?z.domElement.body:z.domElement;if(z.object instanceof THREE.PerspectiveCamera){var r=z.object.position;e.copy(r).sub(z.target);var n=e.length();n*=Math.tan(z.object.fov/2*Math.PI/180),ee(2*t*n/i.clientHeight,z.object.matrix),te(2*o*n/i.clientHeight,z.object.matrix)}else z.object instanceof THREE.OrthographicCamera?(ee(t*(z.object.right-z.object.left)/z.object.zoom/i.clientWidth,z.object.matrix),te(o*(z.object.top-z.object.bottom)/z.object.zoom/i.clientHeight,z.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),z.enablePan=!1)}}();z.domElement.addEventListener("contextmenu",L,!1),z.domElement.addEventListener("mousedown",y,!1),z.domElement.addEventListener("wheel",C,!1),z.domElement.addEventListener("touchstart",S,!1),z.domElement.addEventListener("touchend",j,!1),z.domElement.addEventListener("touchmove",O,!1),window.addEventListener("keydown",P,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var scene,camera,fieldOfView,aspectRatio,nearPlane,farPlane,HEIGHT,WIDTH,renderer,container,shadowLight,objectsInScene=[],Room=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;this.width=e,this.height=t,this.mesh=new THREE.Object3D,this.mesh.castShadow=!0,this.mesh.receiveShadow=!0;var o=new THREE.Mesh(new THREE.PlaneBufferGeometry(e,t),new THREE.MeshPhongMaterial({color:Colors.primaryColor}));o.material.side=THREE.DoubleSide,o.receiveShadow=!0,this.mesh.add(o);var i=new THREE.EdgesGeometry(new THREE.PlaneBufferGeometry(e,t)),r=new THREE.LineBasicMaterial({color:Colors.strokeColor,linewidth:Settings.strokeWidth}),n=new THREE.LineSegments(i,r);this.mesh.rotation.x=Math.PI/2,this.mesh.add(n);var i=new THREE.EdgesGeometry(new THREE.PlaneBufferGeometry(e+10,t+10)),r=new THREE.LineBasicMaterial({color:Colors.strokeColor,linewidth:Settings.strokeWidth}),n=new THREE.LineSegments(i,r);this.mesh.add(n),this.mesh.rotation.x=Math.PI/2;
},Desk=function(e){this.mesh=new THREE.Object3D,this.mesh.castShadow=!0,this.mesh.receiveShadow=!0;var t=new THREE.BoxGeometry(e.width,e.height,e.depth,1,1,1),o=new THREE.MeshPhongMaterial({color:Colors.primaryColor,shading:THREE.FlatShading}),i=createWiredObject({object:t,material:o,click:function(){console.log("click - select desk")},hover:function(){console.log("hover - hightlight desk")}});this.mesh.add(i),this.mesh.position.x+=room.width/2-e.width/2,this.mesh.position.z-=room.height/2-e.height/2,this.mesh.position.y+=e.height/2,this.mesh.position.z+=e.positionZ,this.mesh.position.x-=e.positionX},Door=function(e){e=merge({height:40,width:5,depth:25},e||{}),this.mesh=new THREE.Object3D,this.mesh.castShadow=!0,this.mesh.receiveShadow=!0;var t=new THREE.BoxGeometry(e.width,e.height,e.depth,1,1,1),o=new THREE.MeshPhongMaterial({color:Colors.primaryColor,transparent:!0,opacity:1,shading:THREE.FlatShading}),i=createWiredObject({object:t,material:o,click:function(){console.log("click - door open")},hover:function(){console.log("hover - hightlight door")}});this.mesh.add(i);new THREE.BoxGeometry(e.width/10,e.height/10,e.depth,1,1,1);this.mesh.position.x+=room.width/2-e.width/2,this.mesh.position.z-=room.height/2-e.height/2,this.mesh.position.y+=e.height/2,this.mesh.position.z+=e.positionZ,this.mesh.position.x-=e.positionX},Plant=function(e){e=merge({size:10,positionX:0,positionZ:0},e||{}),this.mesh=new THREE.Object3D,this.mesh.castShadow=!0,this.mesh.receiveShadow=!0;var t=new THREE.CylinderGeometry(e.size,e.size/3,e.size,0,1,!1),o=new THREE.MeshPhongMaterial({color:Colors.primaryColor,shading:THREE.FlatShading}),i=createWiredObject({object:t,material:o});this.mesh.add(i);var r=2*e.size,n=new THREE.CylinderGeometry(2,2,r,0,1,!1),a=new THREE.MeshPhongMaterial({color:Colors.primaryColor,shading:THREE.FlatShading}),s=createWiredObject({object:n,material:a});s.position.y+=r/2,this.mesh.add(s);var h=new THREE.SphereGeometry(1.5*e.size,7,7),c=new THREE.MeshPhongMaterial({color:Colors.primaryColor,shading:THREE.FlatShading}),l=createWiredObject({object:h,material:c});l.position.y+=1.5*r,this.mesh.add(l),this.mesh.position.x+=room.width/2-e.size/2,this.mesh.position.z-=room.height/2-e.size/2,this.mesh.position.y+=e.size/2,this.mesh.position.z+=e.positionZ,this.mesh.position.x-=e.positionX},createWiredObject=function(e){if(e=merge({object:null,color:Colors.strokeColor,click:null,hover:null},e||{}),null==e.object)return!1;this.mesh=new THREE.Object3D;var t=new THREE.Mesh(e.object,e.material);t.castShadow=!0,t.receiveShadow=!0;var o=addStrokeToObject({object:e.object}),i=.98;return t.scale.set(1*i,1*i,1*i),t.click=e.click,t.hover=e.hover,t.add(o),this.mesh.add(t),objectsInScene.push(t),this.mesh},addStrokeToObject=function(e){if(e=merge({object:null,color:Colors.strokeColor,positionZ:0,positionX:0},e||{}),null==e.object)return!1;var t=new THREE.EdgesGeometry(e.object),o=new THREE.LineBasicMaterial({color:e.color,linewidth:Settings.strokeWidth}),i=new THREE.LineSegments(t,o);return i};
//# sourceMappingURL=scripts-min.js.map